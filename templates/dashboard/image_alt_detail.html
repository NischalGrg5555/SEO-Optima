{% extends "dashboard/base.html" %}

{% block title %}Image Alt Analysis Detail | SEO Optima{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-4">
  <!-- Header -->
  <div class="analysis-header mb-4">
    <div class="d-flex align-items-center mb-3">
      <a href="{% url 'dashboard:image_alt_list' %}" class="btn btn-sm btn-light border me-3">
        <i class="bi bi-arrow-left"></i> Back
      </a>
      <div class="flex-grow-1">
        <div class="d-flex align-items-center gap-2 mb-2">
          <span class="badge bg-primary">Image Alt Analysis</span>
          <span class="badge bg-secondary">{{ analysis.total_images }} Images</span>
        </div>
        <h1 class="h3 mb-1 text-break">{{ analysis.url }}</h1>
        <div class="text-muted small">
          <i class="bi bi-calendar3"></i> {{ analysis.created_at|date:"M d, Y" }} at {{ analysis.created_at|date:"H:i" }}
        </div>
      </div>
      <div class="d-flex gap-2">
        <a href="{% url 'dashboard:delete_image_alt_analysis' analysis.pk %}" class="btn btn-sm btn-outline-danger">
          <i class="bi bi-trash"></i> Delete
        </a>
        <button onclick="window.print()" class="btn btn-sm btn-outline-secondary">
          <i class="bi bi-printer"></i> Print
        </button>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row g-3 mb-4">
    <div class="col-lg-4 col-md-6">
      <div class="score-card">
        <div class="score-category">Total Images</div>
        <div class="score-value" style="color: #2563eb;">{{ analysis.total_images }}</div>
        <div class="score-status" style="color: #6b7280;">Found on page</div>
        <div class="score-bar">
          <div class="score-bar-fill" style="width: 100%; background: #2563eb;"></div>
        </div>
      </div>
    </div>
    <div class="col-lg-4 col-md-6">
      <div class="score-card">
        <div class="score-category">With Alt Text</div>
        <div class="score-value" style="color: #10b981;">{{ analysis.images_with_alt }}</div>
        <div class="score-status" style="color: #10b981;">
          {% widthratio analysis.images_with_alt analysis.total_images 100 %}% Complete
        </div>
        <div class="score-bar">
          <div class="score-bar-fill" style="width: {% widthratio analysis.images_with_alt analysis.total_images 100 %}%; background: #10b981;"></div>
        </div>
      </div>
    </div>
    <div class="col-lg-4 col-md-6">
      <div class="score-card">
        <div class="score-category">Missing Alt Text</div>
        <div class="score-value" style="color: #ef4444;">{{ analysis.images_without_alt }}</div>
        <div class="score-status" style="color: #ef4444;">
          {% if analysis.images_without_alt > 0 %}Needs Attention{% else %}Perfect!{% endif %}
        </div>
        <div class="score-bar">
          <div class="score-bar-fill" style="width: {% widthratio analysis.images_without_alt analysis.total_images 100 %}%; background: #ef4444;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Images Table -->
  <div class="card border-0 shadow-sm">
    <div class="card-header bg-white border-bottom">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="bi bi-images text-primary me-2"></i>Images & Alt Text Analysis</h5>
        <span class="badge bg-primary">{{ analysis.images_data|length }} Images Found</span>
      </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th scope="col" style="width: 8%;" class="px-4">#</th>
              <th scope="col" style="width: 42%;">Image Preview & Source</th>
              <th scope="col" style="width: 35%;">Alt Text</th>
              <th scope="col" style="width: 15%;">Status</th>
            </tr>
          </thead>
          <tbody>
            {% for image in analysis.images_data %}
            <tr>
              <td class="text-muted px-4">{{ forloop.counter }}</td>
              <td>
                <div class="d-flex align-items-start gap-3">
                  <img src="{{ image.src }}" 
                       alt="{{ image.alt|default:'No alt text' }}" 
                       class="image-preview" 
                       onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23e9ecef\' width=\'60\' height=\'60\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' dominant-baseline=\'middle\' text-anchor=\'middle\' fill=\'%236c757d\'%3E?%3C/text%3E%3C/svg%3E'">
                  <div class="flex-grow-1">
                    <a href="{{ image.src }}" target="_blank" class="text-decoration-none small text-break" style="word-break: break-all; color: #4b5563;">
                      {{ image.src|truncatechars:80 }}
                    </a>
                  </div>
                </div>
              </td>
              <td>
                {% if image.alt %}
                  <span class="text-dark">{{ image.alt }}</span>
                {% else %}
                  <span class="text-danger fst-italic">No alt text provided</span>
                {% endif %}
              </td>
              <td>
                {% if image.status == 'OK' %}
                  <span class="badge rounded-pill bg-success"><i class="bi bi-check-circle"></i> OK</span>
                {% else %}
                  <span class="badge rounded-pill bg-danger"><i class="bi bi-x-circle"></i> Missing</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<style>
  /* Header Styles */
  .analysis-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    padding: 24px;
    color: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .analysis-header .btn-light {
    background: rgba(255, 255, 255, 0.9);
    border: none;
    font-weight: 500;
  }

  .analysis-header .btn-light:hover {
    background: white;
  }

  .analysis-header h1 {
    color: white;
    font-weight: 600;
  }

  .analysis-header .badge {
    font-size: 0.75rem;
    padding: 6px 12px;
    font-weight: 600;
  }

  .analysis-header .text-muted {
    color: rgba(255, 255, 255, 0.8) !important;
  }

  /* Score Card Styles */
  .score-card {
    background: white;
    border-radius: 12px;
    padding: 24px;
    text-align: center;
    border: 1px solid #e5e7eb;
    transition: all 0.3s ease;
    height: 100%;
  }

  .score-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
  }

  .score-category {
    font-size: 0.875rem;
    font-weight: 600;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
  }

  .score-value {
    font-size: 3.5rem;
    font-weight: 800;
    line-height: 1;
    margin-bottom: 8px;
  }

  .score-status {
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 16px;
  }

  .score-bar {
    width: 100%;
    height: 6px;
    background: #e5e7eb;
    border-radius: 10px;
    overflow: hidden;
  }

  .score-bar-fill {
    height: 100%;
    border-radius: 10px;
    transition: width 1s ease;
  }

  /* Card Styles */
  .card {
    border-radius: 12px;
  }

  .card-header {
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    padding: 16px 24px;
  }

  .card-header h5 {
    font-weight: 600;
    font-size: 1.1rem;
  }

  /* Table Styles */
  .table {
    font-size: 0.9rem;
  }

  .table th {
    font-weight: 600;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #4b5563;
    border-bottom: 2px solid #e5e7eb;
    padding: 14px 12px;
  }

  .table td {
    vertical-align: middle;
    padding: 16px 12px;
    border-bottom: 1px solid #f3f4f6;
  }

  .table tbody tr:hover {
    background-color: #f9fafb;
  }

  .image-preview {
    width: 70px;
    height: 70px;
    object-fit: cover;
    border: 2px solid #e5e7eb;
    border-radius: 10px;
    flex-shrink: 0;
  }

  .badge {
    font-size: 0.75rem;
    padding: 6px 12px;
    font-weight: 600;
  }

  .badge.rounded-pill {
    padding: 6px 14px;
  }

  @media print {
    .btn, .analysis-header .btn {
      display: none !important;
    }
    
    .card {
      border: 1px solid #000 !important;
      box-shadow: none !important;
    }
    
    .analysis-header {
      background: #333 !important;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
  }
</style>
{% endblock %}
